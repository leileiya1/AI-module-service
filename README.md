# AI-Module æ™ºèƒ½äººæ ¼åŒ–èŠå¤©ç³»ç»Ÿ

<div align="center">

[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.6-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![Spring Cloud](https://img.shields.io/badge/Spring%20Cloud-2025.0.0-blue.svg)](https://spring.io/projects/spring-cloud)
[![Spring AI](https://img.shields.io/badge/Spring%20AI-1.0.2-green.svg)](https://spring.io/projects/spring-ai)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-14+-336791.svg)](https://www.postgresql.org/)
[![MongoDB](https://img.shields.io/badge/MongoDB-5.0+-green.svg)](https://www.mongodb.com/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

**ğŸš€ åŸºäºSpring Cloudçš„ä¼ä¸šçº§AIå¯¹è¯å¹³å° | é›†æˆæ™ºè°±AI GLM-4 | æ”¯æŒå‘é‡è®°å¿†ã€çŸ¥è¯†åº“RAGã€æƒ…ç»ªåˆ†æã€ä¸ªæ€§åŒ–å¾®è°ƒ**

[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [åœ¨çº¿æ–‡æ¡£](#apiæ–‡æ¡£) â€¢ [æ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„) â€¢ [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

AI-Module æ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„**æ™ºèƒ½äººæ ¼åŒ–èŠå¤©ç³»ç»Ÿ**ï¼Œé›†æˆäº†å…ˆè¿›çš„AIèƒ½åŠ›ï¼ŒåŒ…æ‹¬å¯¹è¯ç®¡ç†ã€è®°å¿†å­˜å‚¨ã€çŸ¥è¯†åº“ã€äººæ ¼åˆ†æã€æƒ…ç»ªåˆ†æã€è§†è§‰è¯†åˆ«ç­‰åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨Spring Cloudç”Ÿæ€ï¼Œæä¾›é«˜å¯ç”¨ã€å¯æ‰©å±•çš„ä¼ä¸šçº§AIæœåŠ¡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

<table>
  <tr>
    <td>ğŸ§  <b>å‘é‡è®°å¿†ç³»ç»Ÿ</b></td>
    <td>åŸºäºpgvectorçš„é•¿æœŸè®°å¿†å­˜å‚¨ä¸ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œæ”¯æŒè®°å¿†ç½®é¡¶åŠŸèƒ½</td>
  </tr>
  <tr>
    <td>ğŸ“š <b>RAGçŸ¥è¯†åº“</b></td>
    <td>æ–‡æ¡£è§£æã€æ™ºèƒ½åˆ†å—ã€å‘é‡åŒ–å­˜å‚¨ä¸è¯­ä¹‰æœç´¢ï¼Œæ”¯æŒ10MBæ–‡æ¡£</td>
  </tr>
  <tr>
    <td>ğŸ¤– <b>AIå¯¹è¯ç®¡ç†</b></td>
    <td>é›†æˆæ™ºè°±AI GLM-4æ¨¡å‹ï¼Œæ”¯æŒå¤šäººæ ¼åˆ‡æ¢å’Œä¸Šä¸‹æ–‡ç®¡ç†</td>
  </tr>
  <tr>
    <td>ğŸ˜Š <b>æƒ…ç»ªåˆ†æ</b></td>
    <td>å®æ—¶è¯†åˆ«å¯¹è¯æƒ…ç»ªã€è¶‹åŠ¿åˆ†æå’Œæƒ…ç»ªå¯è§†åŒ–</td>
  </tr>
  <tr>
    <td>ğŸ‘¤ <b>äººæ ¼æ´å¯Ÿ</b></td>
    <td>ç”¨æˆ·è¡Œä¸ºåˆ†æã€äººæ ¼ç‰¹å¾æå–ã€å†™ä½œé£æ ¼è¯†åˆ«</td>
  </tr>
  <tr>
    <td>ğŸ¨ <b>æ¨¡å‹å¾®è°ƒ</b></td>
    <td>åŸºäºç”¨æˆ·åé¦ˆæ•°æ®çš„ä¸ªæ€§åŒ–æ¨¡å‹è®­ç»ƒä¸ç®¡ç†</td>
  </tr>
  <tr>
    <td>ğŸ‘ï¸ <b>è§†è§‰åˆ†æ</b></td>
    <td>å›¾åƒå†…å®¹ç†è§£ã€è§†è§‰åœºæ™¯åˆ†æã€å›¾æ–‡ç»“åˆå¯¹è¯</td>
  </tr>
  <tr>
    <td>ğŸ” <b>åˆ†å¸ƒå¼è¿½è¸ª</b></td>
    <td>Zipkiné“¾è·¯è¿½è¸ªï¼Œä¾¿äºç›‘æ§ã€è°ƒè¯•å’Œæ€§èƒ½ä¼˜åŒ–</td>
  </tr>
</table>

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Gateway Service                         â”‚
â”‚                      (APIç½‘å…³å±‚)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Chat      â”‚ â”‚ Memory       â”‚ â”‚ Knowledge    â”‚
â”‚ Service      â”‚ â”‚ Service      â”‚ â”‚ Service      â”‚
â”‚ (æ ¸å¿ƒå¯¹è¯)    â”‚ â”‚ (è®°å¿†ç®¡ç†)    â”‚ â”‚ (çŸ¥è¯†åº“)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Persona      â”‚ â”‚ Emotion      â”‚ â”‚ Vision       â”‚
â”‚ Insight      â”‚ â”‚ Analysis     â”‚ â”‚ Analysis     â”‚
â”‚ (äººæ ¼æ´å¯Ÿ)    â”‚ â”‚ (æƒ…ç»ªåˆ†æ)    â”‚ â”‚ (è§†è§‰åˆ†æ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feedback     â”‚ â”‚ Finetuning   â”‚
â”‚ Service      â”‚ â”‚ Manager      â”‚
â”‚ (åé¦ˆç®¡ç†)    â”‚ â”‚ (å¾®è°ƒç®¡ç†)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Common AI Util                        â”‚
â”‚      (å…¬å…±å·¥å…·æ¨¡å— - Feignå®¢æˆ·ç«¯)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **Java** - 21 (LTS)
- **Spring Boot** - 3.5.6
- **Spring Cloud** - 2025.0.0
- **Spring Cloud Alibaba** - 2025.0.0.0-preview
- **Spring AI** - 1.0.2

### æ•°æ®å­˜å‚¨
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“ + pgvectoræ‰©å±•ï¼ˆå‘é‡æœç´¢ï¼‰
- **MongoDB** - æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆç”¨äºAIå¯¹è¯æœåŠ¡ï¼‰

### AIèƒ½åŠ›
- **æ™ºè°±AI (ZhipuAI)** - GLM-4æ¨¡å‹
- **Zai SDK** - 0.0.6

### æ•°æ®è®¿é—®
- **MyBatis Plus** - 3.5.14
- **Spring Data MongoDB** - æ•°æ®è®¿é—®å±‚

### æœåŠ¡æ²»ç†
- **Spring Cloud OpenFeign** - æœåŠ¡é—´é€šä¿¡
- **Spring Cloud Gateway** - APIç½‘å…³

### ç›‘æ§è¿½è¸ª
- **Micrometer** - åº”ç”¨ç›‘æ§
- **Zipkin** - åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- **Spring Boot Actuator** - å¥åº·æ£€æŸ¥å’ŒæŒ‡æ ‡

### æ–‡æ¡£å·¥å…·
- **SpringDoc OpenAPI** - 2.8.9 (Swagger UI)

### å·¥å…·åº“
- **Lombok** - ç®€åŒ–ä»£ç 
- **PGvector** - PostgreSQLå‘é‡æ‰©å±•

## æ¨¡å—è¯´æ˜

### 1. common-ai-util
**å…¬å…±å·¥å…·æ¨¡å—**
- æä¾›Feignå®¢æˆ·ç«¯æ¥å£ï¼Œä¾›å„æœåŠ¡é—´è°ƒç”¨
- ç»Ÿä¸€çš„DTOå’Œå®ä½“ç±»å®šä¹‰
- é€šç”¨å¼‚å¸¸å¤„ç†
- é›†æˆZipkiné“¾è·¯è¿½è¸ª
- é›†æˆSpringDoc APIæ–‡æ¡£

### 2. gateway-service
**APIç½‘å…³æœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- ç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±è½¬å‘
- è´Ÿè½½å‡è¡¡
- è®¤è¯æˆæƒï¼ˆè§„åˆ’ä¸­ï¼‰

### 3. ai-chat-service
**AIå¯¹è¯æ ¸å¿ƒæœåŠ¡**
- ç«¯å£ï¼š1235
- æ•°æ®åº“ï¼šMongoDB
- åŠŸèƒ½ï¼š
  - åŸºäºæ™ºè°±AIçš„å¯¹è¯ç”Ÿæˆ
  - å¤šäººæ ¼ï¼ˆPersonaï¼‰ç®¡ç†
  - å¯¹è¯å†å²ç®¡ç†
  - ç”¨æˆ·è®¾ç½®ç®¡ç†
  - å†…éƒ¨APIè°ƒç”¨

ä¸»è¦APIï¼š
- `CompanionController` - ä¼´ä¾£å¯¹è¯
- `DialogueController` - é€šç”¨å¯¹è¯
- `PersonaManagementController` - äººæ ¼ç®¡ç†
- `UserSettingsController` - ç”¨æˆ·è®¾ç½®

### 4. memory-service
**è®°å¿†ç®¡ç†æœåŠ¡**
- ç«¯å£ï¼š1236
- æ•°æ®åº“ï¼šPostgreSQL (memory_service_db)
- åŠŸèƒ½ï¼š
  - å¯¹è¯è®°å¿†å­˜å‚¨
  - åŸºäºpgvectorçš„å‘é‡ç›¸ä¼¼åº¦æœç´¢
  - è®°å¿†ç½®é¡¶åŠŸèƒ½
  - æ™ºèƒ½è®°å¿†æ£€ç´¢ï¼ˆä¼˜å…ˆè¿”å›ç½®é¡¶è®°å¿†ï¼‰

æ ¸å¿ƒè¡¨ï¼š
- `memories` - å­˜å‚¨å¯¹è¯è®°å¿†å’Œå‘é‡åµŒå…¥

### 5. knowledge-service
**çŸ¥è¯†åº“æœåŠ¡**
- ç«¯å£ï¼š1237
- æ•°æ®åº“ï¼šPostgreSQL (knowledge_service_db)
- åŠŸèƒ½ï¼š
  - æ–‡æ¡£ä¸Šä¼ å’Œè§£æï¼ˆæ”¯æŒæœ€å¤§10MBï¼‰
  - æ–‡æ¡£åˆ†å—å¤„ç†
  - å‘é‡åŒ–å­˜å‚¨
  - çŸ¥è¯†æ£€ç´¢

æ ¸å¿ƒè¡¨ï¼š
- `document_chunks` - æ–‡æ¡£å—å­˜å‚¨

### 6. persona-insight-service
**äººæ ¼æ´å¯ŸæœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- æ•°æ®åº“ï¼šPostgreSQL
- åŠŸèƒ½ï¼š
  - ç”¨æˆ·è¡Œä¸ºåˆ†æ
  - äººæ ¼ç‰¹å¾æå–
  - å†™ä½œé£æ ¼åˆ†æ
  - åˆ†æä»»åŠ¡ç®¡ç†

æ ¸å¿ƒè¡¨ï¼š
- `style_analysis_jobs` - é£æ ¼åˆ†æä»»åŠ¡

### 7. emotion-analysis-service
**æƒ…ç»ªåˆ†ææœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- åŠŸèƒ½ï¼š
  - å¯¹è¯æƒ…ç»ªè¯†åˆ«
  - æƒ…ç»ªè¶‹åŠ¿åˆ†æ
  - æƒ…ç»ªå¯è§†åŒ–æ•°æ®

### 8. vision-analysis-service
**è§†è§‰åˆ†ææœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- åŠŸèƒ½ï¼š
  - å›¾åƒå†…å®¹ç†è§£
  - è§†è§‰åœºæ™¯åˆ†æ
  - å›¾æ–‡ç»“åˆå¯¹è¯

### 9. feedback-service
**ç”¨æˆ·åé¦ˆæœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- æ•°æ®åº“ï¼šPostgreSQL
- åŠŸèƒ½ï¼š
  - æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆç‚¹èµã€ç¼–è¾‘ï¼‰
  - å¯¼å‡ºä¼˜è´¨å¯¹è¯æ•°æ®
  - ä¸ºæ¨¡å‹å¾®è°ƒæä¾›æ•°æ®æº

æ ¸å¿ƒè¡¨ï¼š
- `feedback_records` - åé¦ˆè®°å½•

### 10. finetuning-manager-service
**æ¨¡å‹å¾®è°ƒç®¡ç†æœåŠ¡**
- ç«¯å£ï¼šå¾…é…ç½®
- æ•°æ®åº“ï¼šPostgreSQL
- åŠŸèƒ½ï¼š
  - å¾®è°ƒä»»åŠ¡åˆ›å»ºå’Œç®¡ç†
  - è®­ç»ƒæ•°æ®å‡†å¤‡
  - å¾®è°ƒçŠ¶æ€è·Ÿè¸ª
  - æ¨¡å‹ç‰ˆæœ¬ç®¡ç†

æ ¸å¿ƒè¡¨ï¼š
- `finetuning_jobs` - å¾®è°ƒä»»åŠ¡

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- JDK 21+
- Maven 3.8+
- PostgreSQL 14+ (éœ€å®‰è£…pgvectoræ‰©å±•)
- MongoDB 5.0+
- Docker (å¯é€‰ï¼Œç”¨äºéƒ¨ç½²Zipkin)

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd AI-module
```

#### 2. é…ç½®æ•°æ®åº“

##### PostgreSQLé…ç½®
```bash
# å®‰è£…pgvectoræ‰©å±•
CREATE EXTENSION vector;

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE memory_service_db;
CREATE DATABASE knowledge_service_db;
CREATE DATABASE feedback_service_db;
CREATE DATABASE finetuning_service_db;
CREATE DATABASE persona_insight_db;

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼ˆè§ sql ç›®å½•ï¼‰
psql -U admin -d memory_service_db -f sql/memory-service-schema.sql
psql -U admin -d knowledge_service_db -f sql/knowledge-service-schema.sql
psql -U admin -d feedback_service_db -f sql/feedback-service-schema.sql
psql -U admin -d finetuning_service_db -f sql/finetuning-service-schema.sql
psql -U admin -d persona_insight_db -f sql/persona-insight-schema.sql
```

##### MongoDBé…ç½®
```bash
# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
use ai_dynamic_personality_service
db.createUser({
  user: "root",
  pwd: "SAPiece@zll9",
  roles: [{role: "readWrite", db: "ai_dynamic_personality_service"}]
})
```

#### 3. é…ç½®æ™ºè°±AI API Key

åœ¨å„æœåŠ¡çš„`application.yaml`ä¸­é…ç½®æ‚¨çš„APIå¯†é’¥ï¼š
```yaml
spring:
  ai:
    zhipuai:
      api-key: your-api-key-here
```

éœ€è¦é…ç½®çš„æœåŠ¡ï¼š
- ai-chat-service
- memory-service
- knowledge-service

#### 4. å¯åŠ¨Zipkinï¼ˆå¯é€‰ï¼‰
```bash
docker run -d -p 9411:9411 openzipkin/zipkin
```

#### 5. æ„å»ºé¡¹ç›®
```bash
mvn clean install
```

#### 6. å¯åŠ¨æœåŠ¡

æŒ‰ä»¥ä¸‹é¡ºåºå¯åŠ¨ï¼š
```bash
# 1. å¯åŠ¨ç½‘å…³æœåŠ¡
cd gateway-service
mvn spring-boot:run

# 2. å¯åŠ¨æ ¸å¿ƒæœåŠ¡
cd ai-chat-service
mvn spring-boot:run

# 3. å¯åŠ¨å…¶ä»–æœåŠ¡ï¼ˆå¯æ ¹æ®éœ€è¦å¯åŠ¨ï¼‰
cd memory-service && mvn spring-boot:run
cd knowledge-service && mvn spring-boot:run
cd emotion-analysis-service && mvn spring-boot:run
# ... å…¶ä»–æœåŠ¡
```

## é…ç½®è¯´æ˜

### ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|-----|------|------|
| gateway-service | å¾…é…ç½® | APIç½‘å…³ |
| ai-chat-service | 1235 | AIå¯¹è¯æœåŠ¡ |
| memory-service | 1236 | è®°å¿†ç®¡ç† |
| knowledge-service | 1237 | çŸ¥è¯†åº“æœåŠ¡ |
| emotion-analysis-service | å¾…é…ç½® | æƒ…ç»ªåˆ†æ |
| vision-analysis-service | å¾…é…ç½® | è§†è§‰åˆ†æ |
| feedback-service | å¾…é…ç½® | åé¦ˆæœåŠ¡ |
| finetuning-manager-service | å¾…é…ç½® | å¾®è°ƒç®¡ç† |
| persona-insight-service | å¾…é…ç½® | äººæ ¼æ´å¯Ÿ |

### æ•°æ®åº“è¿æ¥é…ç½®

ä¿®æ”¹å„æœåŠ¡çš„`application.yaml`ï¼š
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/your_database
    username: your_username
    password: your_password
```

### Zipkiné…ç½®

æ‰€æœ‰æœåŠ¡å·²é…ç½®Zipkinè¿½è¸ªï¼š
```yaml
management:
  zipkin:
    tracing:
      endpoint: http://localhost:9411/api/v2/spans
```

## APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®å„æœåŠ¡çš„Swagger UIæ–‡æ¡£ï¼š

- AI Chat Service: http://localhost:1235/swagger-ui.html
- Memory Service: http://localhost:1236/swagger-ui.html
- Knowledge Service: http://localhost:1237/swagger-ui.html

## æ•°æ®åº“è®¾è®¡

è¯¦ç»†çš„æ•°æ®åº“è¡¨ç»“æ„è¯·å‚è€ƒ `sql` ç›®å½•ä¸‹çš„SQLè„šæœ¬æ–‡ä»¶ã€‚

### æ ¸å¿ƒè¡¨è¯´æ˜

#### memories (è®°å¿†è¡¨)
```sql
- id: ä¸»é”®
- user_id: ç”¨æˆ·ID
- persona_id: äººæ ¼ID
- content: è®°å¿†å†…å®¹
- embedding: å‘é‡åµŒå…¥ (pgvector)
- pinned: æ˜¯å¦ç½®é¡¶
- create_time: åˆ›å»ºæ—¶é—´
- analyzed: æ˜¯å¦å·²åˆ†æ
```

#### feedback_records (åé¦ˆè¡¨)
```sql
- id: ä¸»é”®
- user_id: ç”¨æˆ·ID
- persona_id: äººæ ¼ID
- source_context: åŸå§‹ä¸Šä¸‹æ–‡
- ai_response: AIå“åº”
- feedback_type: åé¦ˆç±»å‹ (LIKED, EDITED, DISLIKED)
- edited_content: ç¼–è¾‘åå†…å®¹
- create_time: åˆ›å»ºæ—¶é—´
```

#### finetuning_jobs (å¾®è°ƒä»»åŠ¡è¡¨)
```sql
- id: ä¸»é”®
- job_id: ä»»åŠ¡ID
- provider_job_id: æä¾›å•†ä»»åŠ¡ID
- user_id: ç”¨æˆ·ID
- persona_id: äººæ ¼ID
- status: ä»»åŠ¡çŠ¶æ€
- base_model: åŸºç¡€æ¨¡å‹
- fine_tuned_model_id: å¾®è°ƒåæ¨¡å‹ID
- training_file_id: è®­ç»ƒæ–‡ä»¶ID
- error_message: é”™è¯¯ä¿¡æ¯
- create_time/update_time: æ—¶é—´æˆ³
```

## å¼€å‘æŒ‡å—

### æ–°å¢æœåŠ¡

1. åœ¨çˆ¶pom.xmlä¸­æ·»åŠ module
2. åˆ›å»ºå­æ¨¡å—å¹¶ç»§æ‰¿çˆ¶POM
3. æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼ˆå‚è€ƒç°æœ‰æœåŠ¡ï¼‰
4. å®ç°Controllerã€Serviceã€Mapper
5. é…ç½®application.yaml
6. åœ¨common-ai-utilä¸­æ·»åŠ Feignå®¢æˆ·ç«¯ï¼ˆå¦‚éœ€è¢«å…¶ä»–æœåŠ¡è°ƒç”¨ï¼‰

### æœåŠ¡é—´è°ƒç”¨

ä½¿ç”¨Feignå®¢æˆ·ç«¯ï¼ˆåœ¨common-ai-utilæ¨¡å—ä¸­å®šä¹‰ï¼‰ï¼š
```java
@Autowired
private MemoryServiceClient memoryServiceClient;

// è°ƒç”¨è®°å¿†æœåŠ¡
List<Memory> memories = memoryServiceClient.searchMemories(request);
```

### å‘é‡æœç´¢

ä½¿ç”¨pgvectorè¿›è¡Œç›¸ä¼¼åº¦æœç´¢ï¼š
```java
// 1. ä½¿ç”¨è‡ªå®šä¹‰TypeHandlerå¤„ç†å‘é‡å­—æ®µ
@TableField(typeHandler = PGvectorTypeHandler.class)
private PGvector embedding;

// 2. åœ¨Mapper XMLä¸­ä½¿ç”¨å‘é‡è·ç¦»è¿ç®—ç¬¦
SELECT * FROM memories
WHERE user_id = #{userId}
ORDER BY embedding <=> #{targetVector}::vector
LIMIT 10;
```

## éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

1. æ„å»ºé•œåƒ
```bash
# æ„å»ºæ‰€æœ‰æœåŠ¡
mvn clean package -DskipTests

# ä¸ºæ¯ä¸ªæœåŠ¡æ„å»ºDockeré•œåƒ
cd ai-chat-service
docker build -t ai-chat-service:latest .
```

2. ä½¿ç”¨Docker Composeå¯åŠ¨
```bash
docker-compose up -d
```

### ä¼ ç»Ÿéƒ¨ç½²

1. æ‰“åŒ…
```bash
mvn clean package -DskipTests
```

2. è¿è¡Œ
```bash
java -jar target/ai-chat-service-0.0.1-SNAPSHOT.jar
```

## ç›‘æ§å’Œè¿ç»´

### å¥åº·æ£€æŸ¥

æ‰€æœ‰æœåŠ¡éƒ½æš´éœ²äº†Actuatorç«¯ç‚¹ï¼š
```
GET http://localhost:{port}/actuator/health
```

### é“¾è·¯è¿½è¸ª

è®¿é—®Zipkin UIæŸ¥çœ‹æœåŠ¡è°ƒç”¨é“¾ï¼š
```
http://localhost:9411
```

### æ—¥å¿—

å„æœåŠ¡æ—¥å¿—çº§åˆ«åœ¨application.yamlä¸­é…ç½®ï¼š
```yaml
logging:
  level:
    com.example: DEBUG
```

## å¸¸è§é—®é¢˜

### 1. pgvectoræ‰©å±•å®‰è£…å¤±è´¥
ç¡®ä¿PostgreSQLç‰ˆæœ¬ >= 11ï¼Œå¹¶æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å®‰è£…pgvectoræ‰©å±•ï¼š
```bash
git clone https://github.com/pgvector/pgvector.git
cd pgvector
make
make install
```

### 2. æ™ºè°±AI APIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®
- ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³
- æŸ¥çœ‹ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 3. æœåŠ¡é—´è°ƒç”¨å¤±è´¥
- ç¡®è®¤Feignå®¢æˆ·ç«¯é…ç½®æ­£ç¡®
- æ£€æŸ¥æœåŠ¡æ˜¯å¦éƒ½å·²å¯åŠ¨
- æŸ¥çœ‹Zipkinè¿½è¸ªå®šä½é—®é¢˜

### 4. MongoDBè¿æ¥å¤±è´¥
- æ£€æŸ¥MongoDBæœåŠ¡æ˜¯å¦è¿è¡Œ
- ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
- URLç¼–ç ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚@éœ€è¦ç¼–ç ä¸º%40ï¼‰

## æœªæ¥è§„åˆ’

- [ ] å®Œå–„APIç½‘å…³çš„è®¤è¯æˆæƒ
- [ ] å®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆNacosï¼‰
- [ ] æ·»åŠ é…ç½®ä¸­å¿ƒ
- [ ] å®Œå–„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] å®ç°CI/CDæµç¨‹
- [ ] æ·»åŠ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ
- [ ] å®ç°æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ
- [ ] æ·»åŠ ç¼“å­˜å±‚ï¼ˆRedisï¼‰
- [ ] å®Œå–„ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è®¸å¯è¯

[å¾…æ·»åŠ ]

## è”ç³»æ–¹å¼

é¡¹ç›®ç»´æŠ¤è€…ï¼šå‘¨ç£Šç£Š
å¾®ä¿¡ï¼šSAPieces
email:zhouleileisapiece@gmail.com,17685219818@163.com
